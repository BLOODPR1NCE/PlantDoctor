<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PlantDoctor - Система мониторинга здоровья растений</title>
    <style>
        /* Основные стили */
        :root {
            --primary-color: #4CAF50;
            --secondary-color: #8BC34A;
            --background-color: #F9F9F9;
            --text-color: #333333;
            --light-text: #777777;
            --white: #FFFFFF;
            --card-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        body {
            font-family: 'Open Sans', sans-serif;
            margin: 0;
            padding: 0;
            color: var(--text-color);
            background-color: var(--background-color);
        }
        
        h1, h2, h3, h4 {
            font-family: 'Montserrat', sans-serif;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        /* Шапка */
        header {
            background-color: var(--white);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
            text-decoration: none;
        }
        
        .nav-links a {
            margin-left: 20px;
            text-decoration: none;
            color: var(--text-color);
            font-weight: 600;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-block;
            border: none;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: var(--white);
        }
        
        .btn-outline {
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            background: transparent;
        }
        
        .btn-small {
            padding: 5px 10px;
            font-size: 14px;
        }
        
        /* Основное содержимое */
        main {
            margin-top: 60px;
            min-height: calc(100vh - 160px);
        }
        
        /* Модальные окна */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 100%;
            position: relative;
        }
        
        .close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 20px;
            cursor: pointer;
            color: var(--light-text);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .form-footer {
            margin-top: 20px;
            text-align: center;
            font-size: 14px;
        }
        
        .form-footer a {
            color: var(--primary-color);
            font-weight: 600;
            cursor: pointer;
        }
        
        /* Герой-блок */
        .hero {
            background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('https://images.unsplash.com/photo-1485955900006-10f4d324d411?ixlib=rb-1.2.1&auto=format&fit=crop&w=1350&q=80');
            background-size: cover;
            background-position: center;
            height: 500px;
            display: flex;
            align-items: center;
            color: var(--white);
            text-align: center;
        }
        
        .hero-content {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .hero h1 {
            font-size: 48px;
            margin-bottom: 20px;
        }
        
        .hero p {
            font-size: 20px;
            margin-bottom: 30px;
        }
        
        /* Личный кабинет */
        .dashboard {
            padding: 40px 0;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .plants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .plant-card {
            background: var(--white);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            cursor: pointer;
            transition: transform 0.3s;
            position: relative;
        }
        
        .plant-card:hover {
            transform: translateY(-5px);
        }
        
        .plant-image {
            height: 200px;
            background-size: cover;
            background-position: center;
        }
        
        .plant-info {
            padding: 20px;
        }
        
        .plant-status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            margin-top: 10px;
        }
        
        .status-need-care {
            background-color: #FFF3E0;
            color: #E65100;
        }
        
        .status-ok {
            background-color: #E8F5E9;
            color: #2E7D32;
        }
        
        .plant-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        /* Модальное окно с деталями растения */
        .plant-details {
            max-width: 800px;
        }
        
        .plant-details-header {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .plant-details-image {
            width: 300px;
            height: 300px;
            background-size: cover;
            background-position: center;
            border-radius: 10px;
            flex-shrink: 0;
        }
        
        .plant-details-content {
            flex-grow: 1;
        }
        
        .plant-details-meta {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        
        .meta-item {
            text-align: center;
        }
        
        .meta-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .meta-label {
            font-size: 14px;
            color: var(--light-text);
        }
        
        .care-instructions {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        /* Профиль пользователя */
        .profile-section {
            background: var(--white);
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            margin-bottom: 30px;
        }
        
        /* Адаптация */
        @media (max-width: 768px) {
            .plant-details-header {
                flex-direction: column;
            }
            
            .plant-details-image {
                width: 100%;
                height: 200px;
            }
            
            .hero h1 {
                font-size: 36px;
            }
            
            .hero p {
                font-size: 18px;
            }
            
            .plants-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Open+Sans&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
    <!-- Шапка -->
    <header>
        <div class="container header-content">
            <a href="#" class="logo" onclick="showPage('home')">PlantDoctor</a>
            <div class="nav-links">
                <a href="#" onclick="showPage('home')">Главная</a>
                <a href="#" onclick="showPage('dashboard')">Мои растения</a>
                <a href="#" onclick="showPage('profile')" id="profile-btn" style="display: none;">Профиль</a>
                <a href="#" id="login-btn" class="btn btn-outline">Войти</a>
                <a href="#" id="register-btn" class="btn btn-primary">Регистрация</a>
                <a href="#" id="logout-btn" class="btn btn-outline" style="display: none;">Выйти</a>
            </div>
        </div>
    </header>

    <!-- Главная страница -->
    <main id="home-page">
        <!-- Герой-блок -->
        <section class="hero">
            <div class="hero-content">
                <h1>Не дайте вашим растениям погибнуть!</h1>
                <p>Умные напоминания и профессиональные советы по уходу за вашими комнатными растениями</p>
                <a href="#" class="btn btn-primary" onclick="showPage('dashboard')">Начать</a>
            </div>
        </section>

        <!-- Все растения -->
        <section class="dashboard">
            <div class="container">
                <div class="dashboard-header">
                    <h2>Каталог растений</h2>
                </div>
                
                <div class="plants-grid" id="all-plants-grid">
                    <!-- Растения будут загружены из БД -->
                </div>
            </div>
        </section>
    </main>

    <!-- Личный кабинет (скрыт по умолчанию) -->
    <main id="dashboard-page" style="display: none;">
        <section class="dashboard">
            <div class="container">
                <div class="dashboard-header">
                    <h2>Мои растения</h2>
                    <a href="#" class="btn btn-primary" onclick="showAddPlantModal()">Добавить растение</a>
                </div>
                
                <div class="plants-grid" id="my-plants-grid">
                    <!-- Растения пользователя будут загружены из БД -->
                </div>
            </div>
        </section>
    </main>

    <!-- Страница профиля -->
    <main id="profile-page" style="display: none;">
        <section class="dashboard">
            <div class="container">
                <div class="dashboard-header">
                    <h2>Мой профиль</h2>
                </div>
                
                <div class="profile-section">
                    <h3>Личные данные</h3>
                    <form id="profile-form">
                        <div class="form-group">
                            <label for="profile-name">Имя</label>
                            <input type="text" id="profile-name" required>
                        </div>
                        <div class="form-group">
                            <label for="profile-email">Email</label>
                            <input type="email" id="profile-email" required>
                        </div>
                        <div class="form-group">
                            <label for="profile-password">Новый пароль (оставьте пустым, если не хотите менять)</label>
                            <input type="password" id="profile-password">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Сохранить изменения</button>
                        </div>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <!-- Модальное окно входа -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="hideModal('login-modal')">&times;</span>
            <h2>Вход в систему</h2>
            <form id="login-form">
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" required>
                </div>
                <div class="form-group">
                    <label for="login-password">Пароль</label>
                    <input type="password" id="login-password" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="hideModal('login-modal')">Отмена</button>
                    <button type="submit" class="btn btn-primary">Войти</button>
                </div>
                <div class="form-footer">
                    Нет аккаунта? <a onclick="showRegisterModal()">Зарегистрируйтесь</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Модальное окно регистрации -->
    <div id="register-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="hideModal('register-modal')">&times;</span>
            <h2>Регистрация</h2>
            <form id="register-form">
                <div class="form-group">
                    <label for="register-name">Имя</label>
                    <input type="text" id="register-name" required>
                </div>
                <div class="form-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" required>
                </div>
                <div class="form-group">
                    <label for="register-password">Пароль</label>
                    <input type="password" id="register-password" required>
                </div>
                <div class="form-group">
                    <label for="register-confirm">Подтвердите пароль</label>
                    <input type="password" id="register-confirm" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="hideModal('register-modal')">Отмена</button>
                    <button type="submit" class="btn btn-primary">Зарегистрироваться</button>
                </div>
                <div class="form-footer">
                    Уже есть аккаунт? <a onclick="showLoginModal()">Войдите</a>
                </div>
            </form>
        </div>
    </div>

    <!-- Модальное окно добавления растения -->
    <div id="add-plant-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="hideModal('add-plant-modal')">&times;</span>
            <h3>Добавить новое растение</h3>
            <form id="add-plant-form">
                <div class="form-group">
                    <label>Название растения</label>
                    <input type="text" id="plant-name" required>
                </div>
                
                <div class="form-group">
                    <label>Тип растения</label>
                    <select id="plant-type" required>
                        <option value="">Выберите тип</option>
                        <option value="orchid">Орхидея</option>
                        <option value="ficus">Фикус</option>
                        <option value="succulent">Суккулент</option>
                        <option value="palm">Пальма</option>
                        <option value="other">Другое</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Фото растения</label>
                    <input type="file" id="plant-photo">
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="hideModal('add-plant-modal')">Отмена</button>
                    <button type="submit" class="btn btn-primary">Добавить</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Модальное окно с деталями растения -->
    <div id="plant-details-modal" class="modal">
        <div class="modal-content plant-details">
            <span class="close-btn" onclick="hideModal('plant-details-modal')">&times;</span>
            <div class="plant-details-header">
                <div class="plant-details-image" id="detail-plant-image"></div>
                <div class="plant-details-content">
                    <h2 id="detail-plant-name">Орхидея Фаленопсис</h2>
                    <p id="detail-plant-type">Тип: Орхидея</p>
                    
                    <div class="plant-details-meta">
                        <div class="meta-item">
                            <div class="meta-value" id="detail-last-watered">2 дня</div>
                            <div class="meta-label">последний полив</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-value" id="detail-water-interval">7 дней</div>
                            <div class="meta-label">интервал полива</div>
                        </div>
                        <div class="meta-item">
                            <div class="meta-value" id="detail-temperature">22°C</div>
                            <div class="meta-label">температура</div>
                        </div>
                    </div>
                    
                    <div class="care-instructions">
                        <h4>Инструкция по уходу</h4>
                        <p id="detail-plant-care">Орхидеи требуют умеренного полива каждые 7-10 дней. Избегайте попадания воды на листья. Оптимальная температура 18-25°C. Требуется яркий рассеянный свет.</p>
                    </div>
                    
                    <div class="form-actions" style="margin-top: 20px;">
                        <button type="button" class="btn btn-outline" onclick="hideModal('plant-details-modal')">Закрыть</button>
                        <button type="button" class="btn btn-primary" onclick="showWateringModalFromDetails()">Отметить полив</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно отметки полива -->
    <div id="watering-modal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="hideModal('watering-modal')">&times;</span>
            <h3>Отметить полив</h3>
            <form id="watering-form">
                <div class="form-group">
                    <label for="watering-date">Дата последнего полива</label>
                    <input type="date" id="watering-date" required>
                </div>
                <div class="form-group">
                    <label for="watering-interval">Интервал полива (дней)</label>
                    <input type="number" id="watering-interval" min="1" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" onclick="hideModal('watering-modal')">Отмена</button>
                    <button type="submit" class="btn btn-primary">Сохранить</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Инициализация "БД" в localStorage
        function initDB() {
            if (!localStorage.getItem('plantDoctorDB')) {
                const db = {
                    users: [],
                    plants: [
                        {
                            id: 'orchid',
                            name: "Орхидея Фаленопсис",
                            type: "Орхидея",
                            image: "https://images.unsplash.com/photo-1517191434949-5e90cd67d2b6?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                            care: "Орхидеи требуют умеренного полива каждые 7-10 дней. Избегайте попадания воды на листья. Оптимальная температура 18-25°C. Требуется яркий рассеянный свет.",
                            temperature: "22°C"
                        },
                        {
                            id: 'ficus',
                            name: "Фикус Бенджамина",
                            type: "Фикус",
                            image: "https://images.unsplash.com/photo-1497250681960-ef046c08a56e?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                            care: "Фикус Бенджамина любит регулярный полив, но без переувлажнения. Оптимальная температура 20-25°C. Нуждается в хорошем освещении, но без прямых солнечных лучей.",
                            temperature: "24°C"
                        },
                        {
                            id: 'succulent',
                            name: "Суккулент",
                            type: "Суккулент",
                            image: "https://images.unsplash.com/photo-1459411552884-841db9b3cc2a?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=80",
                            care: "Суккуленты требуют редкого, но обильного полива. Между поливами почва должна полностью просыхать. Оптимальная температура 18-25°C. Нуждаются в ярком освещении.",
                            temperature: "20°C"
                        }
                    ],
                    userPlants: {}
                };
                localStorage.setItem('plantDoctorDB', JSON.stringify(db));
            }
        }

        // Получить данные из БД
        function getDB() {
            return JSON.parse(localStorage.getItem('plantDoctorDB'));
        }

        // Обновить данные в БД
        function updateDB(db) {
            localStorage.setItem('plantDoctorDB', JSON.stringify(db));
        }

        // Текущий пользователь
        let currentUser = null;
        let currentPlantDetailsId = null;

        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            initDB();
            loadAllPlants();
            showPage('home');
            
            // Проверяем, есть ли сохраненный пользователь
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                updateUserUI();
                showPage('dashboard');
            }
        });

        // Загрузить все растения
        function loadAllPlants() {
            const db = getDB();
            const grid = document.getElementById('all-plants-grid');
            grid.innerHTML = '';
            
            db.plants.forEach(plant => {
                const isAdded = currentUser && db.userPlants[currentUser.email] && 
                                db.userPlants[currentUser.email].some(p => p.plantId === plant.id);
                
                const card = document.createElement('div');
                card.className = 'plant-card';
                card.innerHTML = `
                    <div class="plant-image" style="background-image: url('${plant.image}')"></div>
                    <div class="plant-info">
                        <h3>${plant.name}</h3>
                        <p>Тип: ${plant.type}</p>
                        <div class="plant-actions">
                            ${isAdded ? 
                                '<span class="plant-status status-ok">Уже добавлено</span>' : 
                                `<button class="btn btn-primary btn-small" onclick="addToMyPlants('${plant.id}', event)">Добавить</button>`
                            }
                            <button class="btn btn-outline btn-small" onclick="showPlantDetails('${plant.id}', event)">Подробнее</button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // Загрузить растения пользователя
        function loadUserPlants() {
            if (!currentUser) return;
            
            const db = getDB();
            const grid = document.getElementById('my-plants-grid');
            grid.innerHTML = '';
            
            const userPlants = db.userPlants[currentUser.email] || [];
            
            userPlants.forEach(userPlant => {
                const plant = db.plants.find(p => p.id === userPlant.plantId);
                if (!plant) return;
                
                const lastWatered = userPlant.lastWatered ? 
                    `Последний полив: ${formatDate(userPlant.lastWatered)}` : 
                    'Полив не указан';
                
                const nextWatering = userPlant.waterInterval ? 
                    `Следующий полив: ${getNextWateringDate(userPlant.lastWatered, userPlant.waterInterval)}` : 
                    'Частота полива не указана';
                
                const card = document.createElement('div');
                card.className = 'plant-card';
                card.innerHTML = `
                    <div class="plant-image" style="background-image: url('${plant.image}')"></div>
                    <div class="plant-info">
                        <h3>${plant.name}</h3>
                        <p>${lastWatered}</p>
                        <p>${nextWatering}</p>
                        <div class="plant-actions">
                            <button class="btn btn-primary btn-small" onclick="showWateringModal('${plant.id}', event)">Отметить полив</button>
                            <button class="btn btn-outline btn-small" onclick="showPlantDetails('${plant.id}', event)">Подробнее</button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // Добавить растение в коллекцию пользователя
        function addToMyPlants(plantId, event) {
            event.stopPropagation();
            
            if (!currentUser) {
                showLoginModal();
                return;
            }
            
            const db = getDB();
            
            if (!db.userPlants[currentUser.email]) {
                db.userPlants[currentUser.email] = [];
            }
            
            // Проверяем, есть ли уже это растение у пользователя
            if (!db.userPlants[currentUser.email].some(p => p.plantId === plantId)) {
                db.userPlants[currentUser.email].push({
                    plantId: plantId,
                    lastWatered: null,
                    waterInterval: null
                });
                
                updateDB(db);
                loadAllPlants();
                showPage('dashboard');
            }
        }

        // Показать детали растения
        function showPlantDetails(plantId, event) {
            if (event) event.stopPropagation();
            
            const db = getDB();
            const plant = db.plants.find(p => p.id === plantId);
            if (!plant) return;
            
            currentPlantDetailsId = plantId;
            
            // Заполняем данные растения
            document.getElementById('detail-plant-name').textContent = plant.name;
            document.getElementById('detail-plant-type').textContent = `Тип: ${plant.type}`;
            document.getElementById('detail-plant-image').style.backgroundImage = `url('${plant.image}')`;
            document.getElementById('detail-plant-care').textContent = plant.care;
            document.getElementById('detail-temperature').textContent = plant.temperature;
            
            // Заполняем данные полива, если растение у пользователя
            let lastWatered = 'не указан';
            let waterInterval = 'не указан';
            
            if (currentUser && db.userPlants[currentUser.email]) {
                const userPlant = db.userPlants[currentUser.email].find(p => p.plantId === plantId);
                if (userPlant) {
                    lastWatered = userPlant.lastWatered ? formatDate(userPlant.lastWatered) : 'не указан';
                    waterInterval = userPlant.waterInterval ? `${userPlant.waterInterval} дней` : 'не указан';
                }
            }
            
            document.getElementById('detail-last-watered').textContent = lastWatered;
            document.getElementById('detail-water-interval').textContent = waterInterval;
            
            showModal('plant-details-modal');
        }

        // Показать модальное окно для отметки полива из деталей растения
        function showWateringModalFromDetails() {
            if (!currentPlantDetailsId) return;
            hideModal('plant-details-modal');
            showWateringModal(currentPlantDetailsId);
        }

        // Показать модальное окно для отметки полива
        function showWateringModal(plantId, event) {
            if (event) event.stopPropagation();
            
            const db = getDB();
            const userPlant = currentUser && db.userPlants[currentUser.email] ? 
                db.userPlants[currentUser.email].find(p => p.plantId === plantId) : null;
            
            // Заполняем текущими значениями, если они есть
            if (userPlant) {
                if (userPlant.lastWatered) {
                    document.getElementById('watering-date').value = userPlant.lastWatered;
                } else {
                    document.getElementById('watering-date').value = new Date().toISOString().split('T')[0];
                }
                
                if (userPlant.waterInterval) {
                    document.getElementById('watering-interval').value = userPlant.waterInterval;
                } else {
                    document.getElementById('watering-interval').value = 7; // Значение по умолчанию
                }
            }
            
            // Обработчик формы
            document.getElementById('watering-form').onsubmit = function(e) {
                e.preventDefault();
                
                const date = document.getElementById('watering-date').value;
                const interval = document.getElementById('watering-interval').value;
                
                // Обновляем данные в БД
                const db = getDB();
                const userPlant = db.userPlants[currentUser.email].find(p => p.plantId === plantId);
                
                if (userPlant) {
                    userPlant.lastWatered = date;
                    userPlant.waterInterval = parseInt(interval);
                    updateDB(db);
                    loadUserPlants();
                }
                
                hideModal('watering-modal');
                
                // Если открыты детали, обновляем их
                if (document.getElementById('plant-details-modal').style.display === 'flex') {
                    showPlantDetails(plantId);
                }
            };
            
            showModal('watering-modal');
        }

        // Форматирование даты
        function formatDate(dateString) {
            if (!dateString) return 'не указано';
            
            const date = new Date(dateString);
            return date.toLocaleDateString('ru-RU');
        }

        // Расчет следующей даты полива
        function getNextWateringDate(lastWatered, interval) {
            if (!lastWatered || !interval) return 'не указано';
            
            const date = new Date(lastWatered);
            date.setDate(date.getDate() + parseInt(interval));
            return formatDate(date.toISOString().split('T')[0]);
        }

        // Обновление интерфейса при входе/выходе
        function updateUserUI() {
            if (currentUser) {
                document.getElementById('login-btn').style.display = 'none';
                document.getElementById('register-btn').style.display = 'none';
                document.getElementById('logout-btn').style.display = 'inline-block';
                document.getElementById('profile-btn').style.display = 'inline-block';
                
                // Загружаем профиль
                const db = getDB();
                const user = db.users.find(u => u.email === currentUser.email);
                
                if (user) {
                    document.getElementById('profile-name').value = user.name;
                    document.getElementById('profile-email').value = user.email;
                }
                
                loadUserPlants();
            } else {
                document.getElementById('login-btn').style.display = 'inline-block';
                document.getElementById('register-btn').style.display = 'inline-block';
                document.getElementById('logout-btn').style.display = 'none';
                document.getElementById('profile-btn').style.display = 'none';
            }
            
            loadAllPlants();
        }

        // Вход в систему
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            const db = getDB();
            const user = db.users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = {
                    email: user.email,
                    name: user.name
                };
                
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserUI();
                hideModal('login-modal');
                showPage('dashboard');
            } else {
                alert('Неверный email или пароль');
            }
        });

        // Регистрация
        document.getElementById('register-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('register-name').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const confirm = document.getElementById('register-confirm').value;
            
            if (password !== confirm) {
                alert('Пароли не совпадают');
                return;
            }
            
            const db = getDB();
            
            // Проверяем, есть ли уже пользователь с таким email
            if (db.users.some(u => u.email === email)) {
                alert('Пользователь с таким email уже зарегистрирован');
                return;
            }
            
            // Добавляем нового пользователя
            db.users.push({
                name: name,
                email: email,
                password: password
            });
            
            updateDB(db);
            
            currentUser = {
                email: email,
                name: name
            };
            
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            updateUserUI();
            hideModal('register-modal');
            showPage('dashboard');
        });

        // Обновление профиля
        document.getElementById('profile-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('profile-name').value;
            const email = document.getElementById('profile-email').value;
            const password = document.getElementById('profile-password').value;
            
            const db = getDB();
            const user = db.users.find(u => u.email === currentUser.email);
            
            if (user) {
                // Обновляем данные пользователя
                user.name = name;
                user.email = email;
                
                if (password) {
                    user.password = password;
                }
                
                updateDB(db);
                
                // Обновляем текущего пользователя
                currentUser = {
                    email: email,
                    name: name
                };
                
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateUserUI();
                alert('Данные успешно обновлены');
            }
        });

        // Выход из системы
        document.getElementById('logout-btn').addEventListener('click', function(e) {
            e.preventDefault();
            currentUser = null;
            localStorage.removeItem('currentUser');
            updateUserUI();
            showPage('home');
        });

        // Добавление нового растения
        document.getElementById('add-plant-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('plant-name').value;
            const type = document.getElementById('plant-type').value;
            
            if (name && type) {
                // В реальном приложении здесь нужно добавить растение в БД
                alert(`Растение "${name}" добавлено!`);
                hideModal('add-plant-modal');
            } else {
                alert('Пожалуйста, заполните все обязательные поля');
            }
        });

        // Показать модальное окно
        function showModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
        }

        // Скрыть модальное окно
        function hideModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Показать окно входа
        function showLoginModal() {
            hideModal('register-modal');
            showModal('login-modal');
        }

        // Показать окно регистрации
        function showRegisterModal() {
            hideModal('login-modal');
            showModal('register-modal');
        }

        // Показать окно добавления растения
        function showAddPlantModal() {
            if (!currentUser) {
                showLoginModal();
                return;
            }
            showModal('add-plant-modal');
        }

        // Переключение между страницами
        function showPage(pageId) {
            if ((pageId === 'dashboard' || pageId === 'profile') && !currentUser) {
                showLoginModal();
                return;
            }
            
            document.getElementById('home-page').style.display = 'none';
            document.getElementById('dashboard-page').style.display = 'none';
            document.getElementById('profile-page').style.display = 'none';
            
            document.getElementById(pageId + '-page').style.display = 'block';
            
            if (pageId === 'dashboard') {
                loadUserPlants();
            }
        }

        // Обработчики кнопок
        document.getElementById('login-btn').addEventListener('click', function(e) {
            e.preventDefault();
            showLoginModal();
        });
        
        document.getElementById('register-btn').addEventListener('click', function(e) {
            e.preventDefault();
            showRegisterModal();
        });
    </script>
</body>
</html>